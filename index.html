<!DOCTYPE html>
<html>

<body>

    <canvas id="canvas" width="2" height="2" style="border:1px solid#000000;">
        Your browser does not support the HTML canvas tag.
    </canvas>

    <script>

        var c = document.getElementById("canvas")
        var ctx = c.getContext("2d", { willReadFrequently: true })

        var image = new Image();
        image.src = 'Texture.png';
        image.height = 1024;
        image.width = 1024;


        let cat = document.createElement("canvas");
        cat.width = 1024;
        cat.height = 1024;
        var ctxx = cat.getContext("2d", { willReadFrequently: true });

        var normalMap = new Image();
        normalMap.src = 'NormalMap.png'
        normalMap.height = 1024;
        normalMap.width = 1024;

        let cat2 = document.createElement("canvas");
        cat2.width = 1024;
        cat2.height = 1024;
        var ctxx2 = cat2.getContext("2d", { willReadFrequently: true });



        // Simple vector in 3D with numbers for x, y and z
        class Vec3 {
            constructor(x, y, z) {
                this.x = x
                this.y = y
                this.z = z
            }

            // Add other vector to this one and return the result
            add(other) {
                return new Vec3(this.x + other.x, this.y + other.y, this.z + other.z);
            }

            // Subtract other vector from this one and return the result
            minus(other) {
                return new Vec3(this.x - other.x, this.y - other.y, this.z - other.z);
            }

            // Multiply other vector by this one and return the result
            multiply(other) {
                return new Vec3(this.x * other.x, this.y * other.y, this.z * other.y);
            }

            // Scale this vector by the number scalar and return the result
            scale(scalar) {
                return new Vec3(this.x * scalar, this.y * scalar, this.z * scalar);
            }

            // Calculate the dot product of this vector with the other and return the result
            dot(other) {
                return (this.x * other.x) + (this.y * other.y) + (this.z * other.z);
            }

            // Calculate and return the magnitude of this vector
            get magnitude() {
                return Math.sqrt((this.x * this.x) + (this.y * this.y) + (this.z * this.z));
            }

            // Calculate and return the magnitude of this vector without the square root
            get magnitudeSquared() {
                return (this.x * this.x) + (this.y * this.y) + (this.z * this.z);
            }

            // Return a normalised version of this vector
            get normalised() {
                return this.scale(1/this.magnitude);
            }
        }

        class Tri {
            constructor(a, b, c, an, bn, cn, at, bt, ct) {
                this.a = a.scale(0.05).add(new Vec3(0, 0, -0.6));
                this.b = b.scale(0.05).add(new Vec3(0, 0, -0.6));
                this.c = c.scale(0.05).add(new Vec3(0, 0, -0.6));
                this.an = an;
                this.bn = bn;
                this.cn = cn;
                this.at = at;
                this.bt = bt;
                this.ct = ct;
                this.intensity = 1;
                this.specular = 5000;
                this.colour = new Vec3(0, 1, 1);
                this.normal = new Vec3(0, 0, 0),
                    this.origin = this.CalcOrigin();
            }

            CalcNormal() {
                let v1 = this.b.minus(this.a);
                let v2 = this.c.minus(this.a);

                let Norm = new Vec3((v1.y * v2.z) - (v1.z * v2.y), (v1.z * v2.x) - (v1.x * v2.z), (v1.x * v2.y) - (v1.y * v2.x));

                return Norm.normalised;
            }

            CalcOrigin() {
                return this.a.add(this.b.add(this.c)).scale(1 / 3);
            }

            rayIntersects(ray) {
                /*
                let t = (this.a.minus(ray.origin)).dot(this.normal) / ray.direction.normalised.dot(this.normal);
                */

                let distance = 0;

                if (this.a.minus(this.origin).magnitude > distance) { distance = (this.a.minus(this.origin).magnitude) }
                if (this.b.minus(this.origin).magnitude > distance) { distance = (this.b.minus(this.origin).magnitude) }
                if (this.c.minus(this.origin).magnitude > distance) { distance = (this.c.minus(this.origin).magnitude) }

                let a = ray.direction.dot(ray.direction);
                let b = (ray.direction.scale(2)).dot(ray.origin.minus(this.origin));
                let c = (ray.origin.minus(this.origin).dot(ray.origin.minus(this.origin))) - (distance * distance);
                let d = ((b * b) - (4 * a * c));

                if (d < 0.00001) { return -1; }

                let IntersectS = 100;

                a = ray.direction.dot(ray.direction);
                b = (ray.direction.scale(2)).dot(ray.origin.minus(this.origin.add(this.CalcNormal().scale(-IntersectS))));
                c = (ray.origin.minus(this.origin.add(this.CalcNormal().scale(-IntersectS))).dot(ray.origin.minus(this.origin.add(this.CalcNormal().scale(-IntersectS))))) - (IntersectS * IntersectS);

                d = ((b * b) - (4 * a * c));
                let e = ((b * -1) - Math.sqrt(d)) / (a * 2);

                

                let Contact = ray.origin.add(ray.direction.scale(e));

                let taa = this.a.minus(this.b).magnitude;
                let tba = this.b.minus(this.c).magnitude;
                let tca = this.c.minus(this.a).magnitude;

                let tab = Contact.minus(this.a).magnitude;
                let tac = Contact.minus(this.b).magnitude;

                let tbb = Contact.minus(this.b).magnitude;
                let tbc = Contact.minus(this.c).magnitude;

                let tcb = Contact.minus(this.c).magnitude;
                let tcc = Contact.minus(this.a).magnitude;

                let s = 0.5 * (taa + tba + tca);

                let A = Math.sqrt(s * (s - taa) * (s - tba) * (s - tca));

                let Tas = 0.5 * (taa + tab + tac);
                let Tbs = 0.5 * (tba + tbb + tbc);
                let Tcs = 0.5 * (tca + tcb + tcc);

                let TA = Math.sqrt(Tas * (Tas - taa) * (Tas - tab) * (Tas - tac));
                let TB = Math.sqrt(Tbs * (Tbs - tba) * (Tbs - tbb) * (Tbs - tbc));
                let TC = Math.sqrt(Tcs * (Tcs - tca) * (Tcs - tcb) * (Tcs - tcc));

                if (d < 0.00001 || ((TA + TB + TC) - A) > 0.00001) { return -1; }
                if(ray.quality == 0){return e;}

                this.normal = this.an.scale(TB / A).add(this.bn.scale(TC / A)).add(this.cn.scale(TA / A));
                this.colour = this.at.scale(TB / A).add(this.bt.scale(TC / A)).add(this.ct.scale(TA / A)).scale(1024);

                this.colour = new Vec3(GetTexture(this.colour.x, this.colour.y)[0] / 255, GetTexture(this.colour.x, this.colour.y)[1] / 255, GetTexture(this.colour.x, this.colour.y)[2] / 255);
                return e;
            }

        }

        // A sphere in 3D space. Has centre, radius and colour all of which are Vec3s
        class Sphere {
            constructor(centre, radius, colour, intensity, specular) {
                this.centre = centre
                this.radius = radius
                this.colour = colour
                this.intensity = intensity
                this.specular = specular
            }

            // Calculate the point on the sphere  where the ray intersects using 
            // a quadratic equation and return the t value of the ray for that point
            // If two solutions exist return the minus solution
            // If no solutions exist return -1
            rayIntersects(ray) {
                let a = ray.direction.dot(ray.direction);
                let b = (ray.direction.scale(2)).dot(ray.origin.minus(this.centre));
                let c = (ray.origin.minus(this.centre).dot(ray.origin.minus(this.centre))) - (this.radius * this.radius);

                let d = ((b * b) - (4 * a * c));


                //console.log(d);


                if (d < 0) return -1;
                let e = ((b * -1) - Math.sqrt(d)) / (a * 2);

                return e;

            }
        }

        // Ray which has an origin and direction, both are Vec3s
        class Ray {
            constructor(origin, direction, quality) {
                this.origin = origin
                this.direction = direction
                this.quality = quality;
            }

            // Calculate and return the point in space (a Vec3) for this ray for the given value of t
            pointAt(t) { }
        }

        // The result of casting a ray into our scene
        // Position is the point where the ray intersects a sphere in the scene
        // Normal is the normal unit vector of the sphere at the intersection point
        // t is the t value along the ray where the intersection point is.  This value should, be -1 when the ray hits nothing
        // SphereIndex is the array index of the sphere hit by the ray
        class RayCastResult {
            constructor(position, normal, t, sphereIndex, triangleIndex) {
                this.position = position
                this.normal = normal
                this.t = t
                this.sphereIndex = sphereIndex
                this.triangleIndex = triangleIndex
            }
        }

        // Calculate the intersection point and normal when a ray hits a sphere. Returns a RayCastResult.
        function hit(ray, t, sphereIndex, triangleIndex) {
            let HitPos = ray.origin.add(ray.direction.scale(t));
            let normal = new Vec3(0, 0, 0);
            if (sphereIndex >= 0) {
                normal = HitPos.minus(spheres[sphereIndex].centre).normalised;
            }
            if (triangleIndex >= 0) {
                normal = triangles[triangleIndex].normal;
            }
            return new RayCastResult(HitPos, normal, t, sphereIndex, triangleIndex);
        }

        // Return a RayCastResult when a ray misses everything in the scene
        function miss() {
            return new RayCastResult(new Vec3(0, 0, 0), new Vec3(0, 0, 0), -1, -1)
        }

        // Check whether a ray hits anything in the scene and return a RayCast Result
        function traceRay(ray) {
            let t = 1000000;
            let closestSphereIndex = -1;
            let closestTriangleIndex = -1;

            let current_t = -1;

            for (let i = 0; i < spheres.length; i++) {
                current_t = spheres[i].rayIntersects(ray);
                if (current_t > 0 && current_t < t) {
                    t = current_t;
                    closestSphereIndex = i;
                }
            }

            for (let i = 0; i < triangles.length; i++) {
                current_t = triangles[i].rayIntersects(ray);
                if (current_t > 0 && current_t < t) {
                    t = current_t;
                    closestTriangleIndex = i;
                }
            }

            if (closestTriangleIndex >= 0) return hit(ray, t, closestSphereIndex, closestTriangleIndex);
            if (closestSphereIndex >= 0) return hit(ray, t, closestSphereIndex, closestTriangleIndex);

            return miss();
            //return miss();
        }

        // Calculate and return the background colour based on the ray
        function backgroundColour(ray) {
            let white = new Vec3(1, 1, 1);
            let blue = new Vec3(0.3, 0.5, 0.9);
            t = 0.5 * (ray.direction.y + 1.0);
            return white.scale(1 - t).add(blue.scale(t));
        }

        // Returns the colour the ray should have as a Vec3 with RGB values in [0,1]
        function rayColour(ray) {
            let castResult = traceRay(ray);
            if (castResult.t < 0) return backgroundColour(ray);

            //calculate if pixel is being blocked by an object from the light source

            //return castResult.normal;

            let ShadowNorm = negLightDirection.normalised;
            let ShadowTan1 = new Vec3(0, 1, 0);
            let ShadowTan2 = new Vec3(0, 0, 1);

            let TempNorm = ShadowNorm;

            let xA = Math.acos(TempNorm.y / Math.sqrt((TempNorm.y ** 2) + (TempNorm.z ** 2)));

            TempNorm = new Vec3(TempNorm.x, (TempNorm.y * Math.cos(-xA)) - (TempNorm.z * Math.sin(-xA)), (TempNorm.y * Math.sin(-xA)) + (TempNorm.z * Math.cos(-xA))).normalised;

            let yA = Math.acos(TempNorm.x / Math.sqrt((TempNorm.x ** 2) + (TempNorm.z ** 2)));

            TempNorm = new Vec3((TempNorm.x * Math.cos(-yA)) + (TempNorm.z * Math.sin(-yA)), TempNorm.y, (-TempNorm.x * Math.sin(-yA)) + (TempNorm.z * Math.cos(-yA))).normalised;

            let zA = Math.acos(TempNorm.x / Math.sqrt((TempNorm.y ** 2) + (TempNorm.x ** 2)));

            TempNorm = new Vec3((TempNorm.x * Math.cos(-zA)) - (TempNorm.y * Math.sin(-zA)), (TempNorm.x * Math.sin(-zA)) + (TempNorm.y * Math.cos(-zA)), TempNorm.z).normalised;

            ShadowTan1 = new Vec3((ShadowTan1.x * Math.cos(zA)) - (ShadowTan1.y * Math.sin(zA)), (ShadowTan1.x * Math.sin(zA)) + (ShadowTan1.y * Math.cos(zA)), ShadowTan1.z).normalised;
            ShadowTan1 = new Vec3((ShadowTan1.x * Math.cos(yA)) + (ShadowTan1.z * Math.sin(yA)), ShadowTan1.y, (-ShadowTan1.x * Math.sin(yA)) + (ShadowTan1.z * Math.cos(yA))).normalised;
            ShadowTan1 = new Vec3(ShadowTan1.x, (ShadowTan1.y * Math.cos(xA)) - (ShadowTan1.z * Math.sin(xA)), (ShadowTan1.y * Math.sin(xA)) + (ShadowTan1.z * Math.cos(xA))).normalised;

            ShadowTan2 = new Vec3((ShadowTan2.x * Math.cos(zA)) - (ShadowTan2.y * Math.sin(zA)), (ShadowTan2.x * Math.sin(zA)) + (ShadowTan2.y * Math.cos(zA)), ShadowTan2.z).normalised;
            ShadowTan2 = new Vec3((ShadowTan2.x * Math.cos(yA)) + (ShadowTan2.z * Math.sin(yA)), ShadowTan2.y, (-ShadowTan2.x * Math.sin(yA)) + (ShadowTan2.z * Math.cos(yA))).normalised;
            ShadowTan2 = new Vec3(ShadowTan2.x, (ShadowTan2.y * Math.cos(xA)) - (ShadowTan2.z * Math.sin(xA)), (ShadowTan2.y * Math.sin(xA)) + (ShadowTan2.z * Math.cos(xA))).normalised;




            let shadow = 0;

            let Scatter = 2;
            let ScatterAngle = 0.02;

            let shadowRay = new Ray(new Vec3(0, 0, 0), new Vec3(0, 0, 0),0);
            let shadowResult = traceRay(shadowRay);

            if (true) {
                shadow = 0;
                for (let x = Scatter * -1; x <= Scatter; x++) {
                    for (let y = Scatter * -1; y <= Scatter; y++) {
                        shadowRay = new Ray(castResult.position, ShadowTan1.scale(x / (Scatter / ScatterAngle)).add(ShadowTan2.scale(y / (Scatter / ScatterAngle))).add(ShadowNorm).minus(new Vec3(0, 0, 0)).normalised,0);
                        shadowResult = traceRay(shadowRay);
                        let Bias = (((((x / Scatter) ** 2) * -1) + 1) + ((((y / Scatter) ** 2) * -1) + 1)) / 2;
                        //console.log(`${Bias} || ${x/Scatter} : ${y/Scatter}`);
                        //console.log(shadowResult.t);
                        if (shadowResult.t >= 0 && Math.max(castResult.normal.dot(negLightDirection), 0) > 0 && Bias > 0) shadow += Bias;
                    }
                }
            }



            shadow = shadow / ((((Scatter * 2) + 1) ** 2)/2);

            //console.log(shadow);

            let ObjColour = new Vec3(0, 0, 0);
            let ObjIntensity = 0;
            let ObjSpecular = 0;

            if (castResult.sphereIndex >= 0) {
                ObjColour = spheres[castResult.sphereIndex].colour;
                ObjIntensity = spheres[castResult.sphereIndex].intensity;
                ObjSpecular = spheres[castResult.sphereIndex].specular;
            }
            if (castResult.triangleIndex >= 0) {
                ObjColour = triangles[castResult.triangleIndex].colour;
                ObjIntensity = triangles[castResult.triangleIndex].intensity;
                ObjSpecular = triangles[castResult.triangleIndex].specular;
            }

            //Assign object colour
            let albedo = ObjColour;

            //Assign baseline illumination based on global lighting
            let ambient = lightIntensity * ObjIntensity;

            //Assign basic shading of object based on position of light source and soften shadow using ambient lighting
            let diffuse = Math.max(castResult.normal.dot(negLightDirection), 0) - ((1 - ambient) * shadow);
            if (diffuse < 0) { diffuse = 0; }

            //Calculate the DOT between the camera ray and the reflected light vector based on surface normal
            //Then apply Phong model to the DOT result to get the specular mask of the object

            let specular = ray.direction.normalised.dot(lightDirection.minus(castResult.normal.scale(2 * lightDirection.dot(castResult.normal))));
            specular = Math.pow(Math.cos((specular + 1) / 2), ObjSpecular) * lightIntensity;

            //
            let colour = albedo.scale((diffuse * (1 - (shadow))) + ambient).add(new Vec3(1, 1, 1).scale(specular * (1 - shadow)));
            return colour;
        }

        // Sets a pixel at (x, y) in the canvas with an RGB Vec3
        function setPixel(x, y, colour) {
            ctx.fillStyle = "rgba(" + colour.x + "," + colour.y + "," + colour.z + "," + 1 + ")"
            ctx.fillRect(x, c.height - y, 1, 1)
        }

        function GetTexture(x, y) {
            return ctxx.getImageData(x, 1024 - y, 1, 1).data;
        }

        function GetNormalMap(x, y) {
            return ctxx2.getImageData(x, 1024 - y, 1, 1).data;
        }

        const spheres = new Array(
            new Sphere(new Vec3(0, -0.3, -1), 0.3, new Vec3(1, 0, 0), 1, 500),       // Red sphere
            new Sphere(new Vec3(0.2, 0, -0.5), 0.15, new Vec3(1, 0, 0), 1, 500),
            new Sphere(new Vec3(-0.2, -0.1, -0.8), 0.15, new Vec3(0, 0, 1), 1.1, 5000),  // Blue sphere
            new Sphere(new Vec3(0, -100.5, -1), 100, new Vec3(0, 1, 0), 0.9, 10)   // Big green sphere
        );

        const Points = [
            new Vec3(0, 0, 0),
            new Vec3(0.402881, -5.450802, 0.333520),
            new Vec3(-1.522309, 4.364758, 1.974063),
            new Vec3(0.666889, -5.373248, 0.651095),
            new Vec3(0.622744, -5.258711, 1.052968),
            new Vec3(0.296307, -5.174285, 1.303726),
            new Vec3(-0.155776, -5.254465, 1.338012),
            new Vec3(-1.740136, 3.838295, 2.485884),
            new Vec3(-0.385210, -5.246980, 0.938903),
            new Vec3(-1.945914, 3.890042, 2.283699),
            new Vec3(-0.341065, -5.361517, 0.537031),
            new Vec3(-1.967350, 4.065673, 2.050041),
            new Vec3(-0.014627, -5.445943, 0.286273),
            new Vec3(-1.791887, 4.262307, 1.921786),
            new Vec3(0.637840, -4.436763, -0.307460),
            new Vec3(0.892972, -2.802722, -1.109667),
            new Vec3(0.788360, -1.170476, -1.239487),
            new Vec3(0.641253, -0.085833, -1.180807),
            new Vec3(0.422901, 0.941521, -0.977620),
            new Vec3(0.136632, 1.914265, -0.636677),
            new Vec3(-0.220883, 2.829719, -0.151226),
            new Vec3(-0.680706, 3.662906, 0.541737),
            new Vec3(1.139888, -0.117755, -0.601039),
            new Vec3(1.286994, -1.202399, -0.659718),
            new Vec3(1.343717, -2.753623, -0.516586),
            new Vec3(0.960508, -4.372339, 0.100225),
            new Vec3(1.102364, -0.327231, 0.134146),
            new Vec3(1.249470, -1.411875, 0.075467),
            new Vec3(1.227492, -2.765298, 0.230233),
            new Vec3(0.890658, -4.309098, 0.614574),
            new Vec3(0.550663, -0.591552, 0.594088),
            new Vec3(0.697769, -1.676196, 0.535409),
            new Vec3(0.658175, -2.827433, 0.680421),
            new Vec3(0.486898, -4.283723, 0.929657),
            new Vec3(-1.428285, 3.032751, 2.063838),
            new Vec3(-1.054174, 2.159668, 1.538939),
            new Vec3(-0.696659, 1.244214, 1.053488),
            new Vec3(-0.410389, 0.271471, 0.712545),
            new Vec3(-0.192037, -0.755884, 0.509358),
            new Vec3(-0.044930, -1.840527, 0.450679),
            new Vec3(-0.022878, -2.855608, 0.611749),
            new Vec3(-0.014146, -4.283475, 0.879955),
            new Vec3(-1.850685, 3.114306, 1.527382),
            new Vec3(-1.552808, 2.191591, 0.959171),
            new Vec3(-1.195293, 1.276137, 0.473720),
            new Vec3(-0.909024, 0.303393, 0.132777),
            new Vec3(-0.690671, -0.723961, -0.070410),
            new Vec3(-0.543565, -1.808605, -0.129090),
            new Vec3(-0.452542, -2.945910, 0.085843),
            new Vec3(-0.326123, -4.370445, 0.494439),
            new Vec3(-1.856766, 3.317171, 0.955998),
            new Vec3(-1.515284, 2.401067, 0.223985),
            new Vec3(-1.157769, 1.485613, -0.261466),
            new Vec3(-0.871500, 0.512869, -0.602408),
            new Vec3(-0.653147, -0.514485, -0.805596),
            new Vec3(-0.506041, -1.599129, -0.864275),
            new Vec3(-0.399360, -2.938828, -0.640637),
            new Vec3(-0.280449, -4.434016, -0.012331),
            new Vec3(-1.403538, 3.502971, 0.459274),
            new Vec3(-0.963583, 2.665388, -0.235956),
            new Vec3(-0.606068, 1.749934, -0.721407),
            new Vec3(-0.319799, 0.777190, -1.062350),
            new Vec3(-0.101446, -0.250164, -1.265538),
            new Vec3(0.045660, -1.334808, -1.324217),
            new Vec3(0.151878, -2.880752, -1.154589),
            new Vec3(0.116432, -4.462373, -0.351618),
            new Vec3(-1.895737, 5.195112, 2.506200),
            new Vec3(-2.175543, 4.518854, 3.163650),
            new Vec3(-2.439871, 4.585326, 2.903936),
            new Vec3(-2.467406, 4.810928, 2.603796),
            new Vec3(-2.242019, 5.063511, 2.439049),
            new Vec3(-2.269567, 4.267195, 2.649186),
            new Vec3(-2.297102, 4.492799, 2.349046),
            new Vec3(-2.005239, 4.200725, 2.908899),
            new Vec3(-2.071715, 4.745381, 2.184298),
            new Vec3(-1.725433, 4.876982, 2.251450),
            new Vec3(0.140437, -5.747907, 0.882987),
            new Vec3(0.288825, -5.707187, 1.062297),
            new Vec3(0.263813, -5.649758, 1.290030),
            new Vec3(0.080054, -5.609264, 1.432784),
            new Vec3(-0.155451, -5.609123, 1.408074),
            new Vec3(-0.303198, -5.650144, 1.227626),
            new Vec3(-0.278186, -5.707572, 0.999893),
            new Vec3(-0.094427, -5.748067, 0.857138),
            new Vec3(-0.007267, -5.678627, 1.145104),
            new Vec3(-2.035640, 4.856984, 2.834925),
            new Vec3(-0.680706, 3.662906, 0.541737),
            new Vec3(-1.522309, 4.364758, 1.974063),
            new Vec3(0.641253, -0.085833, -1.180807),
            new Vec3(0.641253, -0.085833, -1.180807),
            new Vec3(0.422901, 0.941521, -0.977620),
            new Vec3(0.136632, 1.914265, -0.636677),
            new Vec3(-0.220883, 2.829719, -0.151226),
            new Vec3(-1.740136, 3.838295, 2.485884),
            new Vec3(-1.428285, 3.032751, 2.063838),
            new Vec3(-1.054174, 2.159668, 1.538939),
            new Vec3(-0.696659, 1.244214, 1.053488),
            new Vec3(-0.410389, 0.271471, 0.712545),
            new Vec3(-0.192037, -0.755884, 0.509358),
            new Vec3(-0.192037, -0.755884, 0.509358),
            new Vec3(0.550663, -0.591552, 0.594088),
            new Vec3(1.102364, -0.327231, 0.134146),
            new Vec3(1.139888, -0.117755, -0.601039),
            new Vec3(-2.439871, 4.585326, 2.903936),
            new Vec3(-2.175543, 4.518854, 3.163650),
            new Vec3(-2.175543, 4.518854, 3.163650),
            new Vec3(-2.467406, 4.810928, 2.603796),
            new Vec3(-2.242019, 5.063511, 2.439049),
            new Vec3(-1.895737, 5.195112, 2.506200),
            new Vec3(-1.895737, 5.195112, 2.506200),
            new Vec3(-2.005239, 4.200725, 2.908899),
            new Vec3(-1.725433, 4.876982, 2.251450),
            new Vec3(-2.035640, 4.856984, 2.834925),
        ];

        const UVCoords = [
            new Vec3(0, 0, 0),
            new Vec3(0.278801, 0.797772, 0),
            new Vec3(0.281112, 0.882422, 0),
            new Vec3(0.254484, 0.888500, 0),
            new Vec3(0.223104, 0.795829, 0),
            new Vec3(0.227278, 0.896613, 0),
            new Vec3(0.177401, 0.790343, 0),
            new Vec3(0.200764, 0.906897, 0),
            new Vec3(0.126924, 0.784045, 0),
            new Vec3(0.177033, 0.918253, 0),
            new Vec3(0.070207, 0.806158, 0),
            new Vec3(0.312902, 0.045699, 0),
            new Vec3(0.276975, 0.056511, 0),
            new Vec3(0.286684, 0.024426, 0),
            new Vec3(0.302381, 0.015346, 0),
            new Vec3(0.220357, 0.043330, 0),
            new Vec3(0.168231, 0.116137, 0),
            new Vec3(0.130036, 0.096079, 0),
            new Vec3(0.196465, 0.020638, 0),
            new Vec3(0.104186, 0.241176, 0),
            new Vec3(0.046062, 0.223714, 0),
            new Vec3(0.074239, 0.359595, 0),
            new Vec3(0.011614, 0.355518, 0),
            new Vec3(0.063673, 0.446990, 0),
            new Vec3(0.000595, 0.446878, 0),
            new Vec3(0.062575, 0.533485, 0),
            new Vec3(0.000141, 0.536531, 0),
            new Vec3(0.071810, 0.619054, 0),
            new Vec3(0.009368, 0.625591, 0),
            new Vec3(0.091271, 0.703196, 0),
            new Vec3(0.030173, 0.715180, 0),
            new Vec3(0.247733, 0.054024, 0),
            new Vec3(0.210364, 0.125204, 0),
            new Vec3(0.162999, 0.247252, 0),
            new Vec3(0.135897, 0.352490, 0),
            new Vec3(0.126297, 0.441793, 0),
            new Vec3(0.125747, 0.530581, 0),
            new Vec3(0.133853, 0.618288, 0),
            new Vec3(0.150900, 0.703305, 0),
            new Vec3(0.252928, 0.128561, 0),
            new Vec3(0.221297, 0.248398, 0),
            new Vec3(0.198385, 0.342631, 0),
            new Vec3(0.190634, 0.436034, 0),
            new Vec3(0.190742, 0.527927, 0),
            new Vec3(0.197396, 0.618952, 0),
            new Vec3(0.210456, 0.708141, 0),
            new Vec3(0.295017, 0.135197, 0),
            new Vec3(0.277588, 0.256783, 0),
            new Vec3(0.263303, 0.342437, 0),
            new Vec3(0.255802, 0.435119, 0),
            new Vec3(0.255502, 0.525619, 0),
            new Vec3(0.262117, 0.616030, 0),
            new Vec3(0.273007, 0.708091, 0),
            new Vec3(0.534314, 0.428818, 0),
            new Vec3(0.520886, 0.353541, 0),
            new Vec3(0.563777, 0.353080, 0),
            new Vec3(0.568519, 0.444834, 0),
            new Vec3(0.506902, 0.229550, 0),
            new Vec3(0.564187, 0.229437, 0),
            new Vec3(0.498005, 0.132353, 0),
            new Vec3(0.562501, 0.142065, 0),
            new Vec3(0.504425, 0.038919, 0),
            new Vec3(0.568519, 0.048916, 0),
            new Vec3(0.504825, 0.427024, 0),
            new Vec3(0.477998, 0.350665, 0),
            new Vec3(0.448632, 0.222142, 0),
            new Vec3(0.436953, 0.113033, 0),
            new Vec3(0.441226, 0.021309, 0),
            new Vec3(0.475996, 0.433678, 0),
            new Vec3(0.434704, 0.353544, 0),
            new Vec3(0.389103, 0.219608, 0),
            new Vec3(0.376128, 0.096800, 0),
            new Vec3(0.377451, 0.005852, 0),
            new Vec3(0.448885, 0.452791, 0),
            new Vec3(0.393732, 0.367951, 0),
            new Vec3(0.328693, 0.228602, 0),
            new Vec3(0.313185, 0.092492, 0),
            new Vec3(0.313222, 0.000141, 0),
            new Vec3(0.395138, 0.523532, 0),
            new Vec3(0.406904, 0.495125, 0),
            new Vec3(0.435311, 0.523532, 0),
            new Vec3(0.244215, 0.949893, 0),
            new Vec3(0.272743, 0.940771, 0),
            new Vec3(0.283778, 0.974135, 0),
            new Vec3(0.254827, 0.983197, 0),
            new Vec3(0.216163, 0.958421, 0),
            new Vec3(0.226170, 0.991708, 0),
            new Vec3(0.301237, 0.930391, 0),
            new Vec3(0.312902, 0.964323, 0),
            new Vec3(0.188129, 0.966250, 0),
            new Vec3(0.197563, 0.999859, 0),
            new Vec3(0.738541, 0.098728, 0),
            new Vec3(0.677343, 0.085796, 0),
            new Vec3(0.678890, 0.035437, 0),
            new Vec3(0.757500, 0.052048, 0),
            new Vec3(0.592319, 0.206066, 0),
            new Vec3(0.737226, 0.177234, 0),
            new Vec3(0.570755, 0.299759, 0),
            new Vec3(0.730485, 0.265609, 0),
            new Vec3(0.568802, 0.389261, 0),
            new Vec3(0.728532, 0.355111, 0),
            new Vec3(0.257862, 0.017602, 0),
            new Vec3(0.271740, 0.025245, 0),
            new Vec3(0.553607, 0.473529, 0),
            new Vec3(0.539299, 0.462193, 0),
            new Vec3(0.249622, 0.000141, 0),
            new Vec3(0.509595, 0.464781, 0),
            new Vec3(0.498838, 0.480969, 0),
            new Vec3(0.524533, 0.459195, 0),
            new Vec3(0.527141, 0.483076, 0),
            new Vec3(0.580506, 0.475842, 0),
            new Vec3(0.740236, 0.441692, 0),
            new Vec3(0.277744, 0.002149, 0),
            new Vec3(0.435311, 0.483359, 0),
            new Vec3(0.406904, 0.551939, 0),
            new Vec3(0.313185, 0.565029, 0),
            new Vec3(0.337105, 0.507279, 0),
            new Vec3(0.337105, 0.622779, 0),
            new Vec3(0.394855, 0.483359, 0),
            new Vec3(0.394855, 0.646699, 0),
            new Vec3(0.605228, 0.559640, 0),
            new Vec3(0.764959, 0.525490, 0),
            new Vec3(0.435311, 0.563706, 0),
            new Vec3(0.686348, 0.000141, 0),
            new Vec3(0.725653, 0.008447, 0),
            new Vec3(0.764959, 0.016753, 0),
        ];

        const PointNormals = [
            new Vec3(0, 0, 0),
            new Vec3(-0.6786, -0.5459, 0.4914),
            new Vec3(-0.6155, -0.6683, 0.4178),
            new Vec3(-0.8289, -0.5344, 0.1654),
            new Vec3(-0.9044, -0.3703, 0.2120),
            new Vec3(-0.9130, -0.0175, -0.4075),
            new Vec3(-0.9308, 0.1262, -0.3431),
            new Vec3(-0.4405, 0.5323, -0.7230),
            new Vec3(-0.4554, 0.5794, -0.6759),
            new Vec3(-0.0889, 0.6957, -0.7128),
            new Vec3(-0.0969, 0.7339, -0.6724),
            new Vec3(-0.4742, 0.3099, 0.8241),
            new Vec3(-0.9720, 0.0677, 0.2248),
            new Vec3(-0.7256, -0.5643, 0.3937),
            new Vec3(-0.3856, -0.4440, 0.8088),
            new Vec3(-0.2683, -0.6737, -0.6886),
            new Vec3(-0.2703, -0.4646, -0.8433),
            new Vec3(0.4503, -0.4960, -0.7424),
            new Vec3(0.3831, -0.7261, -0.5710),
            new Vec3(-0.2645, -0.2783, -0.9233),
            new Vec3(0.4779, -0.2416, -0.8446),
            new Vec3(-0.2739, -0.0538, -0.9602),
            new Vec3(0.4688, 0.0341, -0.8826),
            new Vec3(-0.2876, 0.0692, -0.9553),
            new Vec3(0.3214, 0.1487, -0.9352),
            new Vec3(-0.3142, 0.1746, -0.9332),
            new Vec3(0.0490, 0.2737, -0.9606),
            new Vec3(-0.3400, 0.2769, -0.8987),
            new Vec3(0.0155, 0.4020, -0.9155),
            new Vec3(-0.3778, 0.3960, -0.8369),
            new Vec3(-0.0239, 0.5413, -0.8405),
            new Vec3(-0.8469, -0.3758, -0.3762),
            new Vec3(-0.8655, -0.2367, -0.4415),
            new Vec3(-0.8658, -0.2002, -0.4586),
            new Vec3(-0.8658, -0.1199, -0.4858),
            new Vec3(-0.8683, -0.0929, -0.4873),
            new Vec3(-0.8699, -0.0874, -0.4855),
            new Vec3(-0.8711, -0.0817, -0.4842),
            new Vec3(-0.8900, -0.0465, -0.4535),
            new Vec3(-0.9658, 0.0876, 0.2439),
            new Vec3(-0.9573, -0.0100, 0.2888),
            new Vec3(-0.9563, -0.0841, 0.2799),
            new Vec3(-0.9403, -0.1975, 0.2771),
            new Vec3(-0.9196, -0.3008, 0.2528),
            new Vec3(-0.8892, -0.3999, 0.2221),
            new Vec3(-0.8744, -0.4389, 0.2069),
            new Vec3(-0.4755, 0.2897, 0.8306),
            new Vec3(-0.4788, 0.1354, 0.8674),
            new Vec3(-0.4728, 0.0111, 0.8811),
            new Vec3(-0.5630, -0.1696, 0.8089),
            new Vec3(-0.7208, -0.3454, 0.6009),
            new Vec3(-0.6789, -0.4777, 0.5576),
            new Vec3(-0.6622, -0.5457, 0.5134),
            new Vec3(0.3292, 0.2065, 0.9214),
            new Vec3(0.3068, 0.2234, 0.9252),
            new Vec3(0.2813, 0.1221, 0.9518),
            new Vec3(0.3003, 0.0499, 0.9525),
            new Vec3(0.3225, -0.0075, 0.9465),
            new Vec3(0.8302, -0.1969, 0.5216),
            new Vec3(0.8713, -0.0514, 0.4881),
            new Vec3(0.8795, -0.0140, 0.4757),
            new Vec3(0.8888, 0.0672, 0.4534),
            new Vec3(0.9030, 0.0999, 0.4180),
            new Vec3(0.8238, -0.5572, -0.1039),
            new Vec3(0.9181, -0.3378, -0.2071),
            new Vec3(0.9505, -0.1487, -0.2730),
            new Vec3(0.9491, 0.0767, -0.3056),
            new Vec3(0.9295, 0.1444, -0.3393),
            new Vec3(-0.3856, 0.7202, 0.5767),
            new Vec3(-0.8410, -0.1558, -0.5182),
            new Vec3(-0.7852, -0.6127, 0.0897),
            new Vec3(-0.8218, -0.5523, 0.1403),
            new Vec3(-0.8778, -0.0936, -0.4699),
            new Vec3(-0.3845, 0.3558, -0.8518),
            new Vec3(-0.4196, 0.4199, -0.8048),
            new Vec3(-0.5658, -0.7265, 0.3899),
            new Vec3(-0.5987, -0.6709, 0.4376),
            new Vec3(-0.0420, 0.5395, -0.8409),
            new Vec3(-0.0731, 0.5992, -0.7972),
            new Vec3(0.8778, 0.0936, 0.4699),
            new Vec3(-0.2073, -0.9561, -0.2070),
            new Vec3(-0.6154, -0.7879, -0.0231),
            new Vec3(0.1605, -0.4698, 0.8681),
            new Vec3(0.1704, -0.9776, -0.1236),
            new Vec3(0.4400, -0.8871, 0.1395),
            new Vec3(0.4814, -0.6709, 0.5640),
            new Vec3(-0.0259, -0.9700, 0.2418),
            new Vec3(-0.2365, 0.9375, 0.2551),
        ];

        const triangles = [
            new Tri(Points[94], Points[93], Points[9], PointNormals[1], PointNormals[2], PointNormals[3], UVCoords[1], UVCoords[2], UVCoords[3]),
            new Tri(Points[94], Points[9], Points[42], PointNormals[1], PointNormals[3], PointNormals[4], UVCoords[1], UVCoords[3], UVCoords[4]),
            new Tri(Points[42], Points[9], Points[11], PointNormals[4], PointNormals[3], PointNormals[5], UVCoords[4], UVCoords[3], UVCoords[5]),
            new Tri(Points[42], Points[11], Points[50], PointNormals[4], PointNormals[5], PointNormals[6], UVCoords[4], UVCoords[5], UVCoords[6]),
            new Tri(Points[50], Points[11], Points[13], PointNormals[6], PointNormals[5], PointNormals[7], UVCoords[6], UVCoords[5], UVCoords[7]),
            new Tri(Points[50], Points[13], Points[58], PointNormals[6], PointNormals[7], PointNormals[8], UVCoords[6], UVCoords[7], UVCoords[8]),
            new Tri(Points[58], Points[13], Points[87], PointNormals[8], PointNormals[7], PointNormals[9], UVCoords[8], UVCoords[7], UVCoords[9]),
            new Tri(Points[58], Points[87], Points[86], PointNormals[8], PointNormals[9], PointNormals[10], UVCoords[8], UVCoords[9], UVCoords[10]),
            new Tri(Points[6], Points[8], Points[81], PointNormals[11], PointNormals[12], PointNormals[13], UVCoords[11], UVCoords[12], UVCoords[13]),
            new Tri(Points[6], Points[81], Points[80], PointNormals[11], PointNormals[13], PointNormals[14], UVCoords[11], UVCoords[13], UVCoords[14]),
            new Tri(Points[12], Points[65], Points[14], PointNormals[15], PointNormals[16], PointNormals[17], UVCoords[15], UVCoords[16], UVCoords[17]),
            new Tri(Points[12], Points[14], Points[1], PointNormals[15], PointNormals[17], PointNormals[18], UVCoords[15], UVCoords[17], UVCoords[18]),
            new Tri(Points[65], Points[64], Points[15], PointNormals[16], PointNormals[19], PointNormals[20], UVCoords[16], UVCoords[19], UVCoords[20]),
            new Tri(Points[65], Points[15], Points[14], PointNormals[16], PointNormals[20], PointNormals[17], UVCoords[16], UVCoords[20], UVCoords[17]),
            new Tri(Points[64], Points[63], Points[16], PointNormals[19], PointNormals[21], PointNormals[22], UVCoords[19], UVCoords[21], UVCoords[22]),
            new Tri(Points[64], Points[16], Points[15], PointNormals[19], PointNormals[22], PointNormals[20], UVCoords[19], UVCoords[22], UVCoords[20]),
            new Tri(Points[63], Points[62], Points[88], PointNormals[21], PointNormals[23], PointNormals[24], UVCoords[21], UVCoords[23], UVCoords[24]),
            new Tri(Points[63], Points[88], Points[16], PointNormals[21], PointNormals[24], PointNormals[22], UVCoords[21], UVCoords[24], UVCoords[22]),
            new Tri(Points[62], Points[61], Points[90], PointNormals[23], PointNormals[25], PointNormals[26], UVCoords[23], UVCoords[25], UVCoords[26]),
            new Tri(Points[62], Points[90], Points[88], PointNormals[23], PointNormals[26], PointNormals[24], UVCoords[23], UVCoords[26], UVCoords[24]),
            new Tri(Points[61], Points[60], Points[91], PointNormals[25], PointNormals[27], PointNormals[28], UVCoords[25], UVCoords[27], UVCoords[28]),
            new Tri(Points[61], Points[91], Points[90], PointNormals[25], PointNormals[28], PointNormals[26], UVCoords[25], UVCoords[28], UVCoords[26]),
            new Tri(Points[60], Points[59], Points[92], PointNormals[27], PointNormals[29], PointNormals[30], UVCoords[27], UVCoords[29], UVCoords[30]),
            new Tri(Points[60], Points[92], Points[91], PointNormals[27], PointNormals[30], PointNormals[28], UVCoords[27], UVCoords[30], UVCoords[28]),
            new Tri(Points[59], Points[58], Points[86], PointNormals[29], PointNormals[8], PointNormals[10], UVCoords[29], UVCoords[8], UVCoords[10]),
            new Tri(Points[59], Points[86], Points[92], PointNormals[29], PointNormals[10], PointNormals[30], UVCoords[29], UVCoords[10], UVCoords[30]),
            new Tri(Points[10], Points[57], Points[65], PointNormals[31], PointNormals[32], PointNormals[16], UVCoords[31], UVCoords[32], UVCoords[16]),
            new Tri(Points[10], Points[65], Points[12], PointNormals[31], PointNormals[16], PointNormals[15], UVCoords[31], UVCoords[16], UVCoords[15]),
            new Tri(Points[57], Points[56], Points[64], PointNormals[32], PointNormals[33], PointNormals[19], UVCoords[32], UVCoords[33], UVCoords[19]),
            new Tri(Points[57], Points[64], Points[65], PointNormals[32], PointNormals[19], PointNormals[16], UVCoords[32], UVCoords[19], UVCoords[16]),
            new Tri(Points[56], Points[55], Points[63], PointNormals[33], PointNormals[34], PointNormals[21], UVCoords[33], UVCoords[34], UVCoords[21]),
            new Tri(Points[56], Points[63], Points[64], PointNormals[33], PointNormals[21], PointNormals[19], UVCoords[33], UVCoords[21], UVCoords[19]),
            new Tri(Points[55], Points[54], Points[62], PointNormals[34], PointNormals[35], PointNormals[23], UVCoords[34], UVCoords[35], UVCoords[23]),
            new Tri(Points[55], Points[62], Points[63], PointNormals[34], PointNormals[23], PointNormals[21], UVCoords[34], UVCoords[23], UVCoords[21]),
            new Tri(Points[54], Points[53], Points[61], PointNormals[35], PointNormals[36], PointNormals[25], UVCoords[35], UVCoords[36], UVCoords[25]),
            new Tri(Points[54], Points[61], Points[62], PointNormals[35], PointNormals[25], PointNormals[23], UVCoords[35], UVCoords[25], UVCoords[23]),
            new Tri(Points[53], Points[52], Points[60], PointNormals[36], PointNormals[37], PointNormals[27], UVCoords[36], UVCoords[37], UVCoords[27]),
            new Tri(Points[53], Points[60], Points[61], PointNormals[36], PointNormals[27], PointNormals[25], UVCoords[36], UVCoords[27], UVCoords[25]),
            new Tri(Points[52], Points[51], Points[59], PointNormals[37], PointNormals[38], PointNormals[29], UVCoords[37], UVCoords[38], UVCoords[29]),
            new Tri(Points[52], Points[59], Points[60], PointNormals[37], PointNormals[29], PointNormals[27], UVCoords[37], UVCoords[29], UVCoords[27]),
            new Tri(Points[51], Points[50], Points[58], PointNormals[38], PointNormals[6], PointNormals[8], UVCoords[38], UVCoords[6], UVCoords[8]),
            new Tri(Points[51], Points[58], Points[59], PointNormals[38], PointNormals[8], PointNormals[29], UVCoords[38], UVCoords[8], UVCoords[29]),
            new Tri(Points[8], Points[49], Points[57], PointNormals[12], PointNormals[39], PointNormals[32], UVCoords[12], UVCoords[39], UVCoords[32]),
            new Tri(Points[8], Points[57], Points[10], PointNormals[12], PointNormals[32], PointNormals[31], UVCoords[12], UVCoords[32], UVCoords[31]),
            new Tri(Points[49], Points[48], Points[56], PointNormals[39], PointNormals[40], PointNormals[33], UVCoords[39], UVCoords[40], UVCoords[33]),
            new Tri(Points[49], Points[56], Points[57], PointNormals[39], PointNormals[33], PointNormals[32], UVCoords[39], UVCoords[33], UVCoords[32]),
            new Tri(Points[48], Points[47], Points[55], PointNormals[40], PointNormals[41], PointNormals[34], UVCoords[40], UVCoords[41], UVCoords[34]),
            new Tri(Points[48], Points[55], Points[56], PointNormals[40], PointNormals[34], PointNormals[33], UVCoords[40], UVCoords[34], UVCoords[33]),
            new Tri(Points[47], Points[46], Points[54], PointNormals[41], PointNormals[42], PointNormals[35], UVCoords[41], UVCoords[42], UVCoords[35]),
            new Tri(Points[47], Points[54], Points[55], PointNormals[41], PointNormals[35], PointNormals[34], UVCoords[41], UVCoords[35], UVCoords[34]),
            new Tri(Points[46], Points[45], Points[53], PointNormals[42], PointNormals[43], PointNormals[36], UVCoords[42], UVCoords[43], UVCoords[36]),
            new Tri(Points[46], Points[53], Points[54], PointNormals[42], PointNormals[36], PointNormals[35], UVCoords[42], UVCoords[36], UVCoords[35]),
            new Tri(Points[45], Points[44], Points[52], PointNormals[43], PointNormals[44], PointNormals[37], UVCoords[43], UVCoords[44], UVCoords[37]),
            new Tri(Points[45], Points[52], Points[53], PointNormals[43], PointNormals[37], PointNormals[36], UVCoords[43], UVCoords[37], UVCoords[36]),
            new Tri(Points[44], Points[43], Points[51], PointNormals[44], PointNormals[45], PointNormals[38], UVCoords[44], UVCoords[45], UVCoords[38]),
            new Tri(Points[44], Points[51], Points[52], PointNormals[44], PointNormals[38], PointNormals[37], UVCoords[44], UVCoords[38], UVCoords[37]),
            new Tri(Points[43], Points[42], Points[50], PointNormals[45], PointNormals[4], PointNormals[6], UVCoords[45], UVCoords[4], UVCoords[6]),
            new Tri(Points[43], Points[50], Points[51], PointNormals[45], PointNormals[6], PointNormals[38], UVCoords[45], UVCoords[6], UVCoords[38]),
            new Tri(Points[6], Points[41], Points[49], PointNormals[11], PointNormals[46], PointNormals[39], UVCoords[11], UVCoords[46], UVCoords[39]),
            new Tri(Points[6], Points[49], Points[8], PointNormals[11], PointNormals[39], PointNormals[12], UVCoords[11], UVCoords[39], UVCoords[12]),
            new Tri(Points[41], Points[40], Points[48], PointNormals[46], PointNormals[47], PointNormals[40], UVCoords[46], UVCoords[47], UVCoords[40]),
            new Tri(Points[41], Points[48], Points[49], PointNormals[46], PointNormals[40], PointNormals[39], UVCoords[46], UVCoords[40], UVCoords[39]),
            new Tri(Points[40], Points[39], Points[47], PointNormals[47], PointNormals[48], PointNormals[41], UVCoords[47], UVCoords[48], UVCoords[41]),
            new Tri(Points[40], Points[47], Points[48], PointNormals[47], PointNormals[41], PointNormals[40], UVCoords[47], UVCoords[41], UVCoords[40]),
            new Tri(Points[39], Points[98], Points[46], PointNormals[48], PointNormals[49], PointNormals[42], UVCoords[48], UVCoords[49], UVCoords[42]),
            new Tri(Points[39], Points[46], Points[47], PointNormals[48], PointNormals[42], PointNormals[41], UVCoords[48], UVCoords[42], UVCoords[41]),
            new Tri(Points[98], Points[97], Points[45], PointNormals[49], PointNormals[50], PointNormals[43], UVCoords[49], UVCoords[50], UVCoords[43]),
            new Tri(Points[98], Points[45], Points[46], PointNormals[49], PointNormals[43], PointNormals[42], UVCoords[49], UVCoords[43], UVCoords[42]),
            new Tri(Points[97], Points[96], Points[44], PointNormals[50], PointNormals[51], PointNormals[44], UVCoords[50], UVCoords[51], UVCoords[44]),
            new Tri(Points[97], Points[44], Points[45], PointNormals[50], PointNormals[44], PointNormals[43], UVCoords[50], UVCoords[44], UVCoords[43]),
            new Tri(Points[96], Points[95], Points[43], PointNormals[51], PointNormals[52], PointNormals[45], UVCoords[51], UVCoords[52], UVCoords[45]),
            new Tri(Points[96], Points[43], Points[44], PointNormals[51], PointNormals[45], PointNormals[44], UVCoords[51], UVCoords[45], UVCoords[44]),
            new Tri(Points[95], Points[94], Points[42], PointNormals[52], PointNormals[1], PointNormals[4], UVCoords[52], UVCoords[1], UVCoords[4]),
            new Tri(Points[95], Points[42], Points[43], PointNormals[52], PointNormals[4], PointNormals[45], UVCoords[52], UVCoords[4], UVCoords[45]),
            new Tri(Points[5], Points[33], Points[41], PointNormals[53], PointNormals[54], PointNormals[46], UVCoords[53], UVCoords[54], UVCoords[55]),
            new Tri(Points[5], Points[41], Points[6], PointNormals[53], PointNormals[46], PointNormals[11], UVCoords[53], UVCoords[55], UVCoords[56]),
            new Tri(Points[33], Points[32], Points[40], PointNormals[54], PointNormals[55], PointNormals[47], UVCoords[54], UVCoords[57], UVCoords[58]),
            new Tri(Points[33], Points[40], Points[41], PointNormals[54], PointNormals[47], PointNormals[46], UVCoords[54], UVCoords[58], UVCoords[55]),
            new Tri(Points[32], Points[31], Points[39], PointNormals[55], PointNormals[56], PointNormals[48], UVCoords[57], UVCoords[59], UVCoords[60]),
            new Tri(Points[32], Points[39], Points[40], PointNormals[55], PointNormals[48], PointNormals[47], UVCoords[57], UVCoords[60], UVCoords[58]),
            new Tri(Points[31], Points[100], Points[98], PointNormals[56], PointNormals[57], PointNormals[49], UVCoords[59], UVCoords[61], UVCoords[62]),
            new Tri(Points[31], Points[98], Points[39], PointNormals[56], PointNormals[49], PointNormals[48], UVCoords[59], UVCoords[62], UVCoords[60]),
            new Tri(Points[4], Points[29], Points[33], PointNormals[58], PointNormals[59], PointNormals[54], UVCoords[63], UVCoords[64], UVCoords[54]),
            new Tri(Points[4], Points[33], Points[5], PointNormals[58], PointNormals[54], PointNormals[53], UVCoords[63], UVCoords[54], UVCoords[53]),
            new Tri(Points[29], Points[28], Points[32], PointNormals[59], PointNormals[60], PointNormals[55], UVCoords[64], UVCoords[65], UVCoords[57]),
            new Tri(Points[29], Points[32], Points[33], PointNormals[59], PointNormals[55], PointNormals[54], UVCoords[64], UVCoords[57], UVCoords[54]),
            new Tri(Points[28], Points[27], Points[31], PointNormals[60], PointNormals[61], PointNormals[56], UVCoords[65], UVCoords[66], UVCoords[59]),
            new Tri(Points[28], Points[31], Points[32], PointNormals[60], PointNormals[56], PointNormals[55], UVCoords[65], UVCoords[59], UVCoords[57]),
            new Tri(Points[27], Points[101], Points[100], PointNormals[61], PointNormals[62], PointNormals[57], UVCoords[66], UVCoords[67], UVCoords[61]),
            new Tri(Points[27], Points[100], Points[31], PointNormals[61], PointNormals[57], PointNormals[56], UVCoords[66], UVCoords[61], UVCoords[59]),
            new Tri(Points[3], Points[25], Points[29], PointNormals[63], PointNormals[64], PointNormals[59], UVCoords[68], UVCoords[69], UVCoords[64]),
            new Tri(Points[3], Points[29], Points[4], PointNormals[63], PointNormals[59], PointNormals[58], UVCoords[68], UVCoords[64], UVCoords[63]),
            new Tri(Points[25], Points[24], Points[28], PointNormals[64], PointNormals[65], PointNormals[60], UVCoords[69], UVCoords[70], UVCoords[65]),
            new Tri(Points[25], Points[28], Points[29], PointNormals[64], PointNormals[60], PointNormals[59], UVCoords[69], UVCoords[65], UVCoords[64]),
            new Tri(Points[24], Points[23], Points[27], PointNormals[65], PointNormals[66], PointNormals[61], UVCoords[70], UVCoords[71], UVCoords[66]),
            new Tri(Points[24], Points[27], Points[28], PointNormals[65], PointNormals[61], PointNormals[60], UVCoords[70], UVCoords[66], UVCoords[65]),
            new Tri(Points[23], Points[102], Points[101], PointNormals[66], PointNormals[67], PointNormals[62], UVCoords[71], UVCoords[72], UVCoords[67]),
            new Tri(Points[23], Points[101], Points[27], PointNormals[66], PointNormals[62], PointNormals[61], UVCoords[71], UVCoords[67], UVCoords[66]),
            new Tri(Points[1], Points[14], Points[25], PointNormals[18], PointNormals[17], PointNormals[64], UVCoords[73], UVCoords[74], UVCoords[69]),
            new Tri(Points[1], Points[25], Points[3], PointNormals[18], PointNormals[64], PointNormals[63], UVCoords[73], UVCoords[69], UVCoords[68]),
            new Tri(Points[14], Points[15], Points[24], PointNormals[17], PointNormals[20], PointNormals[65], UVCoords[74], UVCoords[75], UVCoords[70]),
            new Tri(Points[14], Points[24], Points[25], PointNormals[17], PointNormals[65], PointNormals[64], UVCoords[74], UVCoords[70], UVCoords[69]),
            new Tri(Points[15], Points[16], Points[23], PointNormals[20], PointNormals[22], PointNormals[66], UVCoords[75], UVCoords[76], UVCoords[71]),
            new Tri(Points[15], Points[23], Points[24], PointNormals[20], PointNormals[66], PointNormals[65], UVCoords[75], UVCoords[71], UVCoords[70]),
            new Tri(Points[16], Points[88], Points[102], PointNormals[22], PointNormals[24], PointNormals[67], UVCoords[76], UVCoords[77], UVCoords[72]),
            new Tri(Points[16], Points[102], Points[23], PointNormals[22], PointNormals[67], PointNormals[66], UVCoords[76], UVCoords[72], UVCoords[71]),
            new Tri(Points[106], Points[68], Points[112], PointNormals[68], PointNormals[68], PointNormals[68], UVCoords[78], UVCoords[79], UVCoords[80]),
            new Tri(Points[72], Points[71], Points[103], PointNormals[69], PointNormals[70], PointNormals[71], UVCoords[81], UVCoords[82], UVCoords[83]),
            new Tri(Points[72], Points[103], Points[69], PointNormals[69], PointNormals[71], PointNormals[72], UVCoords[81], UVCoords[83], UVCoords[84]),
            new Tri(Points[74], Points[72], Points[69], PointNormals[73], PointNormals[69], PointNormals[72], UVCoords[85], UVCoords[81], UVCoords[84]),
            new Tri(Points[74], Points[69], Points[107], PointNormals[73], PointNormals[72], PointNormals[74], UVCoords[85], UVCoords[84], UVCoords[86]),
            new Tri(Points[71], Points[73], Points[104], PointNormals[70], PointNormals[75], PointNormals[76], UVCoords[82], UVCoords[87], UVCoords[88]),
            new Tri(Points[71], Points[104], Points[103], PointNormals[70], PointNormals[76], PointNormals[71], UVCoords[82], UVCoords[88], UVCoords[83]),
            new Tri(Points[75], Points[74], Points[107], PointNormals[77], PointNormals[73], PointNormals[74], UVCoords[89], UVCoords[85], UVCoords[86]),
            new Tri(Points[75], Points[107], Points[108], PointNormals[77], PointNormals[74], PointNormals[78], UVCoords[89], UVCoords[86], UVCoords[90]),
            new Tri(Points[7], Points[2], Points[111], PointNormals[79], PointNormals[79], PointNormals[79], UVCoords[91], UVCoords[92], UVCoords[93]),
            new Tri(Points[7], Points[111], Points[110], PointNormals[79], PointNormals[79], PointNormals[79], UVCoords[91], UVCoords[93], UVCoords[94]),
            new Tri(Points[87], Points[13], Points[74], PointNormals[9], PointNormals[7], PointNormals[73], UVCoords[9], UVCoords[7], UVCoords[85]),
            new Tri(Points[87], Points[74], Points[75], PointNormals[9], PointNormals[73], PointNormals[77], UVCoords[9], UVCoords[85], UVCoords[89]),
            new Tri(Points[9], Points[93], Points[73], PointNormals[3], PointNormals[2], PointNormals[75], UVCoords[3], UVCoords[2], UVCoords[87]),
            new Tri(Points[9], Points[73], Points[71], PointNormals[3], PointNormals[75], PointNormals[70], UVCoords[3], UVCoords[87], UVCoords[82]),
            new Tri(Points[21], Points[2], Points[7], PointNormals[79], PointNormals[79], PointNormals[79], UVCoords[95], UVCoords[92], UVCoords[91]),
            new Tri(Points[21], Points[7], Points[34], PointNormals[79], PointNormals[79], PointNormals[79], UVCoords[95], UVCoords[91], UVCoords[96]),
            new Tri(Points[13], Points[11], Points[72], PointNormals[7], PointNormals[5], PointNormals[69], UVCoords[7], UVCoords[5], UVCoords[81]),
            new Tri(Points[13], Points[72], Points[74], PointNormals[7], PointNormals[69], PointNormals[73], UVCoords[7], UVCoords[81], UVCoords[85]),
            new Tri(Points[20], Points[21], Points[34], PointNormals[79], PointNormals[79], PointNormals[79], UVCoords[97], UVCoords[95], UVCoords[96]),
            new Tri(Points[20], Points[34], Points[35], PointNormals[79], PointNormals[79], PointNormals[79], UVCoords[97], UVCoords[96], UVCoords[98]),
            new Tri(Points[11], Points[9], Points[71], PointNormals[5], PointNormals[3], PointNormals[70], UVCoords[5], UVCoords[3], UVCoords[82]),
            new Tri(Points[11], Points[71], Points[72], PointNormals[5], PointNormals[70], PointNormals[69], UVCoords[5], UVCoords[82], UVCoords[81]),
            new Tri(Points[19], Points[20], Points[35], PointNormals[79], PointNormals[79], PointNormals[79], UVCoords[99], UVCoords[97], UVCoords[98]),
            new Tri(Points[19], Points[35], Points[36], PointNormals[79], PointNormals[79], PointNormals[79], UVCoords[99], UVCoords[98], UVCoords[100]),
            new Tri(Points[10], Points[12], Points[83], PointNormals[31], PointNormals[15], PointNormals[80], UVCoords[31], UVCoords[15], UVCoords[101]),
            new Tri(Points[10], Points[83], Points[82], PointNormals[31], PointNormals[80], PointNormals[81], UVCoords[31], UVCoords[101], UVCoords[102]),
            new Tri(Points[5], Points[6], Points[80], PointNormals[53], PointNormals[11], PointNormals[14], UVCoords[53], UVCoords[56], UVCoords[103]),
            new Tri(Points[5], Points[80], Points[79], PointNormals[53], PointNormals[14], PointNormals[82], UVCoords[53], UVCoords[103], UVCoords[104]),
            new Tri(Points[12], Points[1], Points[76], PointNormals[15], PointNormals[18], PointNormals[83], UVCoords[15], UVCoords[18], UVCoords[105]),
            new Tri(Points[12], Points[76], Points[83], PointNormals[15], PointNormals[83], PointNormals[80], UVCoords[15], UVCoords[105], UVCoords[101]),
            new Tri(Points[1], Points[3], Points[77], PointNormals[18], PointNormals[63], PointNormals[84], UVCoords[73], UVCoords[68], UVCoords[106]),
            new Tri(Points[1], Points[77], Points[76], PointNormals[18], PointNormals[84], PointNormals[83], UVCoords[73], UVCoords[106], UVCoords[107]),
            new Tri(Points[4], Points[5], Points[79], PointNormals[58], PointNormals[53], PointNormals[82], UVCoords[63], UVCoords[53], UVCoords[104]),
            new Tri(Points[4], Points[79], Points[78], PointNormals[58], PointNormals[82], PointNormals[85], UVCoords[63], UVCoords[104], UVCoords[108]),
            new Tri(Points[3], Points[4], Points[78], PointNormals[63], PointNormals[58], PointNormals[85], UVCoords[68], UVCoords[63], UVCoords[108]),
            new Tri(Points[3], Points[78], Points[77], PointNormals[63], PointNormals[85], PointNormals[84], UVCoords[68], UVCoords[108], UVCoords[106]),
            new Tri(Points[77], Points[78], Points[84], PointNormals[84], PointNormals[85], PointNormals[86], UVCoords[106], UVCoords[108], UVCoords[109]),
            new Tri(Points[8], Points[10], Points[82], PointNormals[12], PointNormals[31], PointNormals[81], UVCoords[12], UVCoords[31], UVCoords[102]),
            new Tri(Points[8], Points[82], Points[81], PointNormals[12], PointNormals[81], PointNormals[13], UVCoords[12], UVCoords[102], UVCoords[13]),
            new Tri(Points[18], Points[19], Points[36], PointNormals[79], PointNormals[79], PointNormals[79], UVCoords[110], UVCoords[99], UVCoords[100]),
            new Tri(Points[18], Points[36], Points[37], PointNormals[79], PointNormals[79], PointNormals[79], UVCoords[110], UVCoords[100], UVCoords[111]),
            new Tri(Points[79], Points[80], Points[84], PointNormals[82], PointNormals[14], PointNormals[86], UVCoords[104], UVCoords[103], UVCoords[109]),
            new Tri(Points[81], Points[82], Points[84], PointNormals[13], PointNormals[81], PointNormals[86], UVCoords[13], UVCoords[102], UVCoords[112]),
            new Tri(Points[83], Points[76], Points[84], PointNormals[80], PointNormals[83], PointNormals[86], UVCoords[101], UVCoords[105], UVCoords[112]),
            new Tri(Points[76], Points[77], Points[84], PointNormals[83], PointNormals[84], PointNormals[86], UVCoords[107], UVCoords[106], UVCoords[109]),
            new Tri(Points[78], Points[79], Points[84], PointNormals[85], PointNormals[82], PointNormals[86], UVCoords[108], UVCoords[104], UVCoords[109]),
            new Tri(Points[80], Points[81], Points[84], PointNormals[14], PointNormals[13], PointNormals[86], UVCoords[14], UVCoords[13], UVCoords[112]),
            new Tri(Points[82], Points[83], Points[84], PointNormals[81], PointNormals[80], PointNormals[86], UVCoords[102], UVCoords[101], UVCoords[112]),
            new Tri(Points[68], Points[105], Points[112], PointNormals[68], PointNormals[68], PointNormals[68], UVCoords[79], UVCoords[113], UVCoords[80]),
            new Tri(Points[70], Points[106], Points[112], PointNormals[68], PointNormals[68], PointNormals[68], UVCoords[114], UVCoords[78], UVCoords[80]),
            new Tri(Points[26], Points[22], Points[30], PointNormals[87], PointNormals[87], PointNormals[87], UVCoords[115], UVCoords[116], UVCoords[117]),
            new Tri(Points[30], Points[22], Points[89], PointNormals[87], PointNormals[87], PointNormals[87], UVCoords[117], UVCoords[116], UVCoords[118]),
            new Tri(Points[30], Points[89], Points[99], PointNormals[87], PointNormals[87], PointNormals[87], UVCoords[117], UVCoords[118], UVCoords[119]),
            new Tri(Points[17], Points[18], Points[37], PointNormals[79], PointNormals[79], PointNormals[79], UVCoords[120], UVCoords[110], UVCoords[111]),
            new Tri(Points[17], Points[37], Points[38], PointNormals[79], PointNormals[79], PointNormals[79], UVCoords[120], UVCoords[111], UVCoords[121]),
            new Tri(Points[109], Points[70], Points[112], PointNormals[68], PointNormals[68], PointNormals[68], UVCoords[122], UVCoords[114], UVCoords[80]),
            new Tri(Points[111], Points[66], Points[85], PointNormals[79], PointNormals[79], PointNormals[79], UVCoords[93], UVCoords[123], UVCoords[124]),
            new Tri(Points[67], Points[110], Points[85], PointNormals[79], PointNormals[79], PointNormals[79], UVCoords[125], UVCoords[94], UVCoords[124]),
            new Tri(Points[110], Points[111], Points[85], PointNormals[79], PointNormals[79], PointNormals[79], UVCoords[94], UVCoords[93], UVCoords[124]),
        ];
        //console.log(GetTexture(0.1,0.2));
        // Main code
        let imageWidth = document.getElementById("canvas").width
        let imageHeight = document.getElementById("canvas").height
        let aspectRatio = document.getElementById("canvas").height / document.getElementById("canvas").width

        let viewportWidth = 2;
        let viewportHeight = viewportWidth * aspectRatio;
        let focalLength = 1.0;

        let camPosition = new Vec3(0, 0, 0);
        let horizontal = new Vec3(viewportWidth, 0, 0);
        let vertical = new Vec3(0, viewportHeight, 0);
        let lowerLeftCorner = camPosition.minus(horizontal.scale(0.5)).minus(vertical.scale(0.5)).minus(new Vec3(0, 0, focalLength));

        let lightDirection = new Vec3(-1.1, -1.3, -1.5).normalised;
        let negLightDirection = new Vec3(-lightDirection.x, -lightDirection.y, -lightDirection.z);
        let lightIntensity = 0.4;

        let colour = new Vec3(0, 0, 0)

        let AntiAliasing = 3;

        let progress = 0;

        var startTime = performance.now();
        image.onload = function () {
            normalMap.onload = function () {
                ctxx.drawImage(image, 0, 0);
                ctxx2.drawImage(normalMap,0,0);

                for (let i = 0; i < imageWidth; i++) {

                    for (let j = 0; j <= imageHeight; j++) {


                        colour = new Vec3(0, 0, 0);

                        let u = i / (imageWidth - 1);
                        let v = j / (imageHeight - 1);


                        let ray = new Ray(camPosition, lowerLeftCorner.add(horizontal.scale(u)).add(vertical.scale(v)).minus(camPosition),1);

                        colour = colour.add(rayColour(ray).scale(255));




                        setPixel(i, j, colour);


                    }


                }


                let SmoothPoints = [];

                for (let i = 0; i < imageWidth; i++) {

                    for (let j = 0; j <= imageHeight; j++) {

                        let THold = 16;

                        if (
                            Math.abs(ctx.getImageData(i, imageHeight - j, 1, 1).data[0] - ctx.getImageData(i + 1, imageHeight - j, 1, 1).data[0]) > THold ||
                            Math.abs(ctx.getImageData(i, imageHeight - j, 1, 1).data[0] - ctx.getImageData(i, (imageHeight - j) - 1, 1, 1).data[0]) > THold ||
                            Math.abs(ctx.getImageData(i, imageHeight - j, 1, 1).data[1] - ctx.getImageData(i + 1, imageHeight - j, 1, 1).data[1]) > THold ||
                            Math.abs(ctx.getImageData(i, imageHeight - j, 1, 1).data[1] - ctx.getImageData(i, (imageHeight - j) - 1, 1, 1).data[1]) > THold ||
                            Math.abs(ctx.getImageData(i, imageHeight - j, 1, 1).data[2] - ctx.getImageData(i + 1, imageHeight - j, 1, 1).data[2]) > THold ||
                            Math.abs(ctx.getImageData(i, imageHeight - j, 1, 1).data[2] - ctx.getImageData(i, (imageHeight - j) - 1, 1, 1).data[2]) > THold ||

                            Math.abs(ctx.getImageData(i, imageHeight - j, 1, 1).data[0] - ctx.getImageData(i - 1, imageHeight - j, 1, 1).data[0]) > THold ||
                            Math.abs(ctx.getImageData(i, imageHeight - j, 1, 1).data[0] - ctx.getImageData(i, (imageHeight - j) + 1, 1, 1).data[0]) > THold ||
                            Math.abs(ctx.getImageData(i, imageHeight - j, 1, 1).data[1] - ctx.getImageData(i - 1, imageHeight - j, 1, 1).data[1]) > THold ||
                            Math.abs(ctx.getImageData(i, imageHeight - j, 1, 1).data[1] - ctx.getImageData(i, (imageHeight - j) + 1, 1, 1).data[1]) > THold ||
                            Math.abs(ctx.getImageData(i, imageHeight - j, 1, 1).data[2] - ctx.getImageData(i - 1, imageHeight - j, 1, 1).data[2]) > THold ||
                            Math.abs(ctx.getImageData(i, imageHeight - j, 1, 1).data[2] - ctx.getImageData(i, (imageHeight - j) + 1, 1, 1).data[2]) > THold ) {

                            SmoothPoints.push(new Vec3(i, j, 0));
                            //setPixel(i, j,new Vec3(0,0,0));

                        }

                    }
                }
                //console.log(SmoothPoints);
                
                for (let i = 0; i < SmoothPoints.length; i++) {
                    colour = new Vec3(0, 0, 0);
                    
                    for (let a = 0; a < AntiAliasing; a++) {
                        for (let b = 0; b < AntiAliasing; b++) {

                            let u = (SmoothPoints[i].x + ((a / AntiAliasing) - 0.5)) / (imageWidth - 1);
                            let v = (SmoothPoints[i].y + ((b / AntiAliasing) - 0.5)) / (imageHeight - 1);


                            let ray = new Ray(camPosition, lowerLeftCorner.add(horizontal.scale(u)).add(vertical.scale(v)).minus(camPosition),1);

                            colour = colour.add(rayColour(ray).scale(255));


                        }
                    }

                    colour = colour.scale(1 / AntiAliasing ** 2);
                    

                    setPixel(SmoothPoints[i].x, SmoothPoints[i].y, colour);
                    
                }
                

                var endTime = performance.now();

                console.log(`Render took ${endTime - startTime} milliseconds`)
            }
        }





    </script>

</body>

</html>
